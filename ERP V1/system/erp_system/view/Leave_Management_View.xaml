<UserControl x:Class="erp_system.view.Leave_Management_View"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:erp_system.view"
             xmlns:view_model="clr-namespace:erp_system.view_model"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="1000">
    <UserControl.DataContext>
        <view_model:Leave_Management_View_Model />
    </UserControl.DataContext>

    <ScrollViewer VerticalScrollBarVisibility="Auto" Background="#EEEEFA">
        <Border CornerRadius="16" Background="White" Margin="24" Padding="24">
            <Border.Effect>
                <DropShadowEffect Color="#000000" Opacity="0.08" ShadowDepth="0" BlurRadius="20"/>
            </Border.Effect>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <!-- Summary Cards -->
                    <RowDefinition Height="Auto"/>
                    <!-- Filters and Actions -->
                    <RowDefinition Height="*"/>
                    <!-- Leave Applications -->
                </Grid.RowDefinitions>

                <!-- ===== SUMMARY CARDS ===== -->
                <Grid Grid.Row="0" Margin="0,0,0,20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <!-- Pending Approvals -->
                    <Border Grid.Column="0" CornerRadius="12" BorderBrush="#E5E7EB" BorderThickness="1" Padding="20" Margin="0,0,8,0" 
                            Background="#F8FAFC" MinHeight="120">
                        <StackPanel VerticalAlignment="Center">
                            <DockPanel Margin="0,0,0,8">
                                <TextBlock Text="⏰" FontSize="20" DockPanel.Dock="Right" Foreground="#F59E0B"/>
                                <TextBlock Text="Pending Approvals" FontWeight="Bold" FontSize="14" Foreground="#374151"/>
                            </DockPanel>
                            <TextBlock Text="{Binding PendingApprovals}" FontSize="24" FontWeight="Bold" Foreground="#1F2937" Margin="0,0,0,4"/>
                            <TextBlock Text="Awaiting review" FontSize="11" Foreground="#6B7280"/>
                        </StackPanel>
                    </Border>

                    <!-- This Month -->
                    <Border Grid.Column="1" CornerRadius="12" BorderBrush="#E5E7EB" BorderThickness="1" Padding="20" Margin="4,0" 
                            Background="#F8FAFC" MinHeight="120">
                        <StackPanel VerticalAlignment="Center">
                            <DockPanel Margin="0,0,0,8">
                                <TextBlock Text="📅" FontSize="20" DockPanel.Dock="Right" Foreground="#3B82F6"/>
                                <TextBlock Text="This Month" FontWeight="Bold" FontSize="14" Foreground="#374151"/>
                            </DockPanel>
                            <TextBlock Text="{Binding ThisMonthLeaves}" FontSize="24" FontWeight="Bold" Foreground="#1F2937" Margin="0,0,0,4"/>
                            <TextBlock Text="Leave requests" FontSize="11" Foreground="#6B7280"/>
                        </StackPanel>
                    </Border>

                    <!-- Total Leave Requests This Year -->
                    <Border Grid.Column="2" CornerRadius="12" BorderBrush="#E5E7EB" BorderThickness="1" Padding="20" Margin="8,0,0,0" 
                            Background="#F8FAFC" MinHeight="120">
                        <StackPanel VerticalAlignment="Center">
                            <DockPanel Margin="0,0,0,8">
                                <TextBlock Text="📊" FontSize="20" DockPanel.Dock="Right" Foreground="#8B5CF6"/>
                                <TextBlock Text="Total Requests" FontWeight="Bold" FontSize="14" Foreground="#374151"/>
                            </DockPanel>
                            <TextBlock Text="{Binding TotalRequestsThisYear}" FontSize="24" FontWeight="Bold" Foreground="#1F2937" Margin="0,0,0,4"/>
                            <TextBlock Text="This year" FontSize="11" Foreground="#6B7280"/>
                        </StackPanel>
                    </Border>
                </Grid>

                <!-- ===== FILTERS AND ACTIONS ===== -->
                <DockPanel Grid.Row="1" Margin="0,0,0,20">
                    <!-- Left: Search Filters -->
                    <StackPanel DockPanel.Dock="Left" Orientation="Horizontal" HorizontalAlignment="Left">
                        <!-- Search Box -->
                        <Border Background="White" CornerRadius="6" BorderBrush="#DDD" BorderThickness="1" Padding="10" Width="250" Margin="0,0,15,0">
                            <DockPanel>
                                <TextBlock Text="🔍" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" BorderThickness="0" Background="Transparent"/>
                            </DockPanel>
                        </Border>

                        <!-- Status Filter -->
                        <ComboBox ItemsSource="{Binding StatusOptions}" SelectedItem="{Binding SelectedStatus}" Width="120" Height="40" Padding="5" Background="White" BorderBrush="#DDD" BorderThickness="1" Margin="0,0,15,0" HorizontalContentAlignment="Left" VerticalContentAlignment="Center">
                        </ComboBox>
                    </StackPanel>

                    <!-- Right: Actions -->
                    <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="🔄 Refresh" Width="100" Height="40" Margin="0,0,10,0"
                                Background="#E5E7EB" Foreground="#111827" FontWeight="Bold" BorderThickness="0" Cursor="Hand"
                                Command="{Binding Refresh_Command}"/>
                        <Button Content=" + Create Request " Width="140" Height="40"
                                Background="#FACC15" Foreground="Black" FontWeight="Bold" BorderThickness="0" Cursor="Hand"
                                Command="{Binding OpenCreateRequestDialog_Command}"/>
                    </StackPanel>
                </DockPanel>

                <!-- ===== LEAVE APPLICATIONS ===== -->
                <Border Grid.Row="2" CornerRadius="12" BorderBrush="#E5E7EB" BorderThickness="1" Padding="24" Background="White">
                    <StackPanel>
                        <DockPanel Margin="0,0,0,20">
                            <TextBlock Text="📋 Leave Applications" FontWeight="Bold" FontSize="18" Foreground="#1F2937" DockPanel.Dock="Left"/>
                            <TextBlock Text="{Binding FilteredLeaveRequests.Count, StringFormat=({0} requests)}" FontSize="12" Foreground="#6B7280" DockPanel.Dock="Left" Margin="8,0,0,0"/>
                        </DockPanel>

                        <DataGrid ItemsSource="{Binding PagedLeaveRequests}" AutoGenerateColumns="False" HeadersVisibility="Column" CanUserAddRows="False"
                                  GridLinesVisibility="None" RowHeaderWidth="0" AlternatingRowBackground="#F8FAFC" 
                                  RowHeight="48" FontSize="13" Background="#FFFFFF" BorderThickness="0"
                                  CanUserResizeColumns="True" CanUserSortColumns="True"
                                  VirtualizingPanel.IsVirtualizing="False" VirtualizingPanel.VirtualizationMode="Standard"
                                  ScrollViewer.VerticalScrollBarVisibility="Auto" ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                  MinHeight="300" MaxHeight="500">
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Background" Value="#F1F5F9"/>
                                    <Setter Property="Foreground" Value="#475569"/>
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Setter Property="FontSize" Value="12"/>
                                    <Setter Property="Padding" Value="16,12"/>
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                    <Setter Property="VerticalContentAlignment" Value="Center"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                            <DataGrid.RowStyle>
                                <Style TargetType="DataGridRow">
                                    <Setter Property="Background" Value="White"/>
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="Margin" Value="0,0"/>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#F1F5F9"/>
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background" Value="#E0F2FE"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.RowStyle>
                            <DataGrid.CellStyle>
                                <Style TargetType="DataGridCell">
                                    <Setter Property="Padding" Value="16,12"/>
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
                                    <Setter Property="Foreground" Value="#1E293B"/>
                                    <Style.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Foreground" Value="#0F172A"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.CellStyle>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Employee" Binding="{Binding EmployeeName}" Width="*" MinWidth="120"/>
                                <DataGridTextColumn Header="Type" Binding="{Binding TypeName}" Width="*" MinWidth="100"/>
                                <DataGridTextColumn Header="Start Date" Binding="{Binding StartDate, StringFormat=yyyy-MM-dd}" Width="*" MinWidth="100"/>
                                <DataGridTextColumn Header="End Date" Binding="{Binding EndDate, StringFormat=yyyy-MM-dd}" Width="*" MinWidth="100"/>
                                <DataGridTextColumn Header="Request Date" Binding="{Binding RequestDate, StringFormat=yyyy-MM-dd}" Width="*" MinWidth="100"/>
                                <DataGridTemplateColumn Header="Status" Width="*" MinWidth="100" SortMemberPath="StatusSortOrder">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Background="{Binding Status, Converter={x:Static local:StatusToColorConverter.Instance}}" 
                                                    CornerRadius="12" Padding="8,4" HorizontalAlignment="Center">
                                                <TextBlock Text="{Binding Status}" 
                                                           Foreground="White" 
                                                           FontWeight="SemiBold" 
                                                           FontSize="11"
                                                           HorizontalAlignment="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Header="Approved By" Binding="{Binding ApprovedBy}" Width="*" MinWidth="100"/>
                                <DataGridTemplateColumn Header="Actions" Width="240" MinWidth="240">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                <Button Content="✓ Approve" Command="{Binding DataContext.ApproveLeaveRequest_Command, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                                        CommandParameter="{Binding}" Padding="8,4" Margin="2" Background="#10B981" 
                                                        Foreground="White" BorderThickness="0" FontSize="10" FontWeight="SemiBold" Cursor="Hand"
                                                        Visibility="{Binding Status, Converter={x:Static local:StatusToVisibilityConverter.Instance}, ConverterParameter=Pending}">
                                                    <Button.Style>
                                                        <Style TargetType="Button">
                                                            <Setter Property="Template">
                                                                <Setter.Value>
                                                                    <ControlTemplate TargetType="Button">
                                                                        <Border Background="{TemplateBinding Background}" 
                                                                                CornerRadius="6" Padding="{TemplateBinding Padding}">
                                                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                                        </Border>
                                                                    </ControlTemplate>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Style>
                                                    </Button.Style>
                                                </Button>
                                                <Button Content="✗ Reject" Command="{Binding DataContext.RejectLeaveRequest_Command, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                                        CommandParameter="{Binding}" Padding="8,4" Margin="2" Background="#EF4444" 
                                                        Foreground="White" BorderThickness="0" FontSize="10" FontWeight="SemiBold" Cursor="Hand"
                                                        Visibility="{Binding Status, Converter={x:Static local:StatusToVisibilityConverter.Instance}, ConverterParameter=Pending}">
                                                    <Button.Style>
                                                        <Style TargetType="Button">
                                                            <Setter Property="Template">
                                                                <Setter.Value>
                                                                    <ControlTemplate TargetType="Button">
                                                                        <Border Background="{TemplateBinding Background}" 
                                                                                CornerRadius="6" Padding="{TemplateBinding Padding}">
                                                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                                        </Border>
                                                                    </ControlTemplate>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Style>
                                                    </Button.Style>
                                                </Button>
                                                <Button Content="🗑 Delete" Command="{Binding DataContext.DeleteLeaveRequest_Command, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                                        CommandParameter="{Binding}" Padding="8,4" Margin="2" Background="#F59E0B" 
                                                        Foreground="White" BorderThickness="0" FontSize="10" FontWeight="SemiBold" Cursor="Hand">
                                                    <Button.Style>
                                                        <Style TargetType="Button">
                                                            <Setter Property="Template">
                                                                <Setter.Value>
                                                                    <ControlTemplate TargetType="Button">
                                                                        <Border Background="{TemplateBinding Background}" 
                                                                                CornerRadius="6" Padding="{TemplateBinding Padding}">
                                                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                                        </Border>
                                                                    </ControlTemplate>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Style>
                                                    </Button.Style>
                                                </Button>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>

                        <!-- Pagination Controls -->
                        <Border Background="#F8FAFC" CornerRadius="6" Padding="15" Margin="0,20,0,0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Page Info -->
                                <TextBlock Grid.Column="0" Text="{Binding PageInfo}" 
                                           FontSize="14" FontWeight="Medium" 
                                           Foreground="#64748B" VerticalAlignment="Center"/>

                                <!-- Pagination Buttons -->
                                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right">
                                    <!-- First Page -->
                                    <Button Content="⏮" Width="35" Height="35" Margin="2"
                                            Background="White" Foreground="#64748B" 
                                            BorderBrush="#E2E8F0" BorderThickness="1"
                                            FontSize="12" FontWeight="Bold"
                                            Command="{Binding FirstPage_Command}"
                                            ToolTip="First Page">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="#F1F5F9"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>

                                    <!-- Previous Page -->
                                    <Button Content="◀" Width="35" Height="35" Margin="2"
                                            Background="White" Foreground="#64748B" 
                                            BorderBrush="#E2E8F0" BorderThickness="1"
                                            FontSize="12" FontWeight="Bold"
                                            Command="{Binding PreviousPage_Command}"
                                            ToolTip="Previous Page">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="#F1F5F9"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>

                                    <!-- Current Page Display -->
                                    <Border Background="#3B82F6" CornerRadius="4" Padding="12,8" Margin="5,0">
                                        <TextBlock Text="{Binding CurrentPage}" 
                                                   FontSize="14" FontWeight="Bold" 
                                                   Foreground="White" HorizontalAlignment="Center"/>
                                    </Border>

                                    <!-- Next Page -->
                                    <Button Content="▶" Width="35" Height="35" Margin="2"
                                            Background="White" Foreground="#64748B" 
                                            BorderBrush="#E2E8F0" BorderThickness="1"
                                            FontSize="12" FontWeight="Bold"
                                            Command="{Binding NextPage_Command}"
                                            ToolTip="Next Page">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="#F1F5F9"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>

                                    <!-- Last Page -->
                                    <Button Content="⏭" Width="35" Height="35" Margin="2"
                                            Background="White" Foreground="#64748B" 
                                            BorderBrush="#E2E8F0" BorderThickness="1"
                                            FontSize="12" FontWeight="Bold"
                                            Command="{Binding LastPage_Command}"
                                            ToolTip="Last Page">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="#F1F5F9"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </ScrollViewer>
</UserControl>
