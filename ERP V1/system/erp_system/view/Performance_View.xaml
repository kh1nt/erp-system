<UserControl x:Class="erp_system.view.Performance_View"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:erp_system.view"
             xmlns:view_model="clr-namespace:erp_system.view_model"
             xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <UserControl.DataContext>
        <view_model:Performance_View_Model />
    </UserControl.DataContext>
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <!-- Filter Panel -->
                <RowDefinition Height="Auto"/>
                <!-- Performance Summary Cards -->
                <RowDefinition Height="Auto"/>
                <!-- Charts Row 1 -->
                <RowDefinition Height="Auto"/>
                <!-- Charts Row 2 -->
                <RowDefinition Height="Auto"/>
                <!-- Performance Table -->
            </Grid.RowDefinitions>

            <!-- ===== SIMPLIFIED FILTER PANEL ===== -->
            <Border Grid.Row="0" Background="#F8FAFC" CornerRadius="8" BorderBrush="#E5E7EB" BorderThickness="1" Padding="20" Margin="0,0,0,20">
                <StackPanel>
                    <!-- Header -->
                    <DockPanel Margin="0,0,0,15">
                        <TextBlock Text="🔍 Performance Filters" FontWeight="Bold" FontSize="16" DockPanel.Dock="Left"/>
                        <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                            <Button Content="Apply" Command="{Binding ApplyFilters_Command}" Width="80" Height="32" 
                                    Background="#3B82F6" Foreground="White" FontWeight="Bold" BorderThickness="0" Margin="0,0,8,0"/>
                            <Button Content="Clear" Command="{Binding ClearFilters_Command}" Width="60" Height="32" 
                                    Background="#6B7280" Foreground="White" FontWeight="Bold" BorderThickness="0"/>
                        </StackPanel>
                    </DockPanel>
                    
                    <!-- Essential Filters Only -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Date Range -->
                        <StackPanel Grid.Column="0" Margin="0,0,20,0">
                            <TextBlock Text="📅 Date Range" FontWeight="SemiBold" Margin="0,0,0,8"/>
                            <StackPanel Orientation="Horizontal">
                                <DatePicker SelectedDate="{Binding FilterStartDate}" Width="120" Margin="0,0,10,0"/>
                                <TextBlock Text="to" VerticalAlignment="Center" Margin="0,0,10,0" Foreground="#666"/>
                                <DatePicker SelectedDate="{Binding FilterEndDate}" Width="120"/>
                            </StackPanel>
                        </StackPanel>
                        
                        <!-- Department -->
                        <StackPanel Grid.Column="1" Margin="0,0,20,0">
                            <TextBlock Text="🏢 Department" FontWeight="SemiBold" Margin="0,0,0,8"/>
                            <ComboBox ItemsSource="{Binding Departments}" SelectedItem="{Binding SelectedDepartment}" 
                                      Width="180" Height="28"/>
                        </StackPanel>
                        
                        <!-- Action Buttons -->
                        <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Bottom">
                            <Button Content="📊 Export" Command="{Binding ExportData_Command}" Width="90" Height="32" 
                                    Background="#10B981" Foreground="White" FontWeight="Bold" BorderThickness="0" Margin="0,0,8,0"/>
                            <Button Content="🔄 Refresh" Command="{Binding Refresh_Command}" Width="80" Height="32" 
                                    Background="#8B5CF6" Foreground="White" FontWeight="Bold" BorderThickness="0"/>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- ===== PERFORMANCE SUMMARY CARDS ===== -->
            <UniformGrid Grid.Row="1" Columns="4" HorizontalAlignment="Stretch" Margin="0,0,0,20">
                <!-- Card 1 -->
                <Border Background="White" CornerRadius="8" BorderBrush="#EEE" BorderThickness="1" Padding="15" Margin="5">
                    <StackPanel>
                        <TextBlock Text="Total Evaluations" Foreground="#444"/>
                        <TextBlock Text="{Binding TotalEvaluations}" FontWeight="Bold" FontSize="18"/>
                        <TextBlock Text="🏆" FontSize="20" HorizontalAlignment="Right"/>
                    </StackPanel>
                </Border>

                <!-- Card 2 -->
                <Border Background="White" CornerRadius="8" BorderBrush="#EEE" BorderThickness="1" Padding="15" Margin="5">
                    <StackPanel>
                        <TextBlock Text="Average Rating" Foreground="#444"/>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding AverageScore}" FontWeight="Bold" FontSize="18" Margin="0,0,10,0"/>
                            <TextBlock Text="⭐" FontSize="16" VerticalAlignment="Center"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Card 3 -->
                <Border Background="White" CornerRadius="8" BorderBrush="#EEE" BorderThickness="1" Padding="15" Margin="5">
                    <StackPanel>
                        <TextBlock Text="Sales Achievement" Foreground="#444"/>
                        <TextBlock Text="{Binding SalesAchievementRate, StringFormat={}{0:F1}%}" Foreground="#10B981" FontWeight="Bold" FontSize="18"/>
                        <TextBlock Text="📈" FontSize="20" HorizontalAlignment="Right"/>
                    </StackPanel>
                </Border>

                <!-- Card 4 -->
                <Border Background="White" CornerRadius="8" BorderBrush="#EEE" BorderThickness="1" Padding="15" Margin="5">
                    <StackPanel>
                        <TextBlock Text="Top Department" Foreground="#444"/>
                        <TextBlock Text="{Binding TopDepartment}" FontWeight="Bold" FontSize="16"/>
                        <TextBlock Text="🏢" FontSize="20" HorizontalAlignment="Right"/>
                    </StackPanel>
                </Border>
            </UniformGrid>

            <!-- ===== PERFORMANCE DISTRIBUTION CHARTS ===== -->
            <Grid Grid.Row="2" Margin="0,0,0,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Score Distribution Chart -->
                <Border Grid.Column="0" Background="White" CornerRadius="8" BorderBrush="#EEE" BorderThickness="1" Padding="20" Margin="5">
                    <StackPanel>
                        <TextBlock Text="Performance Score Distribution" FontWeight="Bold" FontSize="16" Margin="0,0,0,15"/>
                        <lvc:CartesianChart Series="{Binding ScoreDistributionSeries}" Height="250">
                            <lvc:CartesianChart.AxisX>
                                <lvc:Axis Labels="{Binding ScoreDistributionLabels}" FontSize="12"/>
                            </lvc:CartesianChart.AxisX>
                            <lvc:CartesianChart.AxisY>
                                <lvc:Axis LabelFormatter="{Binding CountFormatter}" FontSize="12"/>
                            </lvc:CartesianChart.AxisY>
                        </lvc:CartesianChart>
                    </StackPanel>
                </Border>

                <!-- Department Performance Chart -->
                <Border Grid.Column="1" Background="White" CornerRadius="8" BorderBrush="#EEE" BorderThickness="1" Padding="20" Margin="5">
                    <StackPanel>
                        <TextBlock Text="Department Performance Comparison" FontWeight="Bold" FontSize="16" Margin="0,0,0,15"/>
                        <lvc:CartesianChart Series="{Binding DepartmentPerformanceSeries}" Height="250">
                            <lvc:CartesianChart.AxisX>
                                <lvc:Axis Labels="{Binding DepartmentLabels}" FontSize="12"/>
                            </lvc:CartesianChart.AxisX>
                            <lvc:CartesianChart.AxisY>
                                <lvc:Axis LabelFormatter="{Binding ScoreFormatter}" FontSize="12"/>
                            </lvc:CartesianChart.AxisY>
                        </lvc:CartesianChart>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- ===== TREND CHARTS ===== -->
            <Grid Grid.Row="3" Margin="0,0,0,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Monthly Performance Trend -->
                <Border Grid.Column="0" Background="White" CornerRadius="8" BorderBrush="#EEE" BorderThickness="1" Padding="20" Margin="5">
                    <StackPanel>
                        <TextBlock Text="Monthly Performance Trend" FontWeight="Bold" FontSize="16" Margin="0,0,0,15"/>
                        <lvc:CartesianChart Series="{Binding MonthlyTrendSeries}" Height="250">
                            <lvc:CartesianChart.AxisX>
                                <lvc:Axis Labels="{Binding MonthlyTrendLabels}" FontSize="12"/>
                            </lvc:CartesianChart.AxisX>
                            <lvc:CartesianChart.AxisY>
                                <lvc:Axis LabelFormatter="{Binding ScoreFormatter}" FontSize="12"/>
                            </lvc:CartesianChart.AxisY>
                        </lvc:CartesianChart>
                    </StackPanel>
                </Border>

                <!-- Sales Achievement Trend -->
                <Border Grid.Column="1" Background="White" CornerRadius="8" BorderBrush="#EEE" BorderThickness="1" Padding="20" Margin="5">
                    <StackPanel>
                        <TextBlock Text="Sales Achievement Trend" FontWeight="Bold" FontSize="16" Margin="0,0,0,15"/>
                        <lvc:CartesianChart Series="{Binding SalesAchievementSeries}" Height="250">
                            <lvc:CartesianChart.AxisX>
                                <lvc:Axis Labels="{Binding MonthlyTrendLabels}" FontSize="12"/>
                            </lvc:CartesianChart.AxisX>
                            <lvc:CartesianChart.AxisY>
                                <lvc:Axis LabelFormatter="{Binding PercentageFormatter}" FontSize="12"/>
                            </lvc:CartesianChart.AxisY>
                        </lvc:CartesianChart>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- ===== PERFORMANCE BREAKDOWN ===== -->
            <Grid Grid.Row="4" Margin="0,0,0,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="3*"/>
                    <ColumnDefinition Width="2*"/>
                </Grid.ColumnDefinitions>

                <!-- Performance Records Table -->
                <Border Grid.Column="0" Background="White" CornerRadius="8" BorderBrush="#EEE" BorderThickness="1" Padding="20" Margin="5">
                    <StackPanel>
                        <TextBlock Text="Performance Records" FontWeight="Bold" FontSize="16" Margin="0,0,0,15"/>
                        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto" MaxHeight="350">
                            <DataGrid ItemsSource="{Binding PerformanceRecords}" AutoGenerateColumns="False" CanUserAddRows="False" 
                                      GridLinesVisibility="Horizontal" RowHeaderWidth="0" Height="Auto" 
                                      HeadersVisibility="Column" AlternatingRowBackground="#F8FAFC"
                                      FontSize="12" RowHeight="32">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Date" Binding="{Binding ReviewDate, StringFormat=yyyy-MM-dd}" Width="90" 
                                                        HeaderStyle="{StaticResource {x:Type DataGridColumnHeader}}" 
                                                        ElementStyle="{StaticResource {x:Type TextBlock}}"/>
                                    <DataGridTextColumn Header="Employee" Binding="{Binding EmployeeName}" Width="140" 
                                                        HeaderStyle="{StaticResource {x:Type DataGridColumnHeader}}" 
                                                        ElementStyle="{StaticResource {x:Type TextBlock}}"/>
                                    <DataGridTextColumn Header="Department" Binding="{Binding Department}" Width="120" 
                                                        HeaderStyle="{StaticResource {x:Type DataGridColumnHeader}}" 
                                                        ElementStyle="{StaticResource {x:Type TextBlock}}"/>
                                    <DataGridTextColumn Header="Score" Binding="{Binding Score, StringFormat={}{0:F1}}" Width="70" 
                                                        HeaderStyle="{StaticResource {x:Type DataGridColumnHeader}}" 
                                                        ElementStyle="{StaticResource {x:Type TextBlock}}"/>
                                    <DataGridTextColumn Header="Sales %" Binding="{Binding SalesAchievementPercentage, StringFormat={}{0:F1}%}" Width="90" 
                                                        HeaderStyle="{StaticResource {x:Type DataGridColumnHeader}}" 
                                                        ElementStyle="{StaticResource {x:Type TextBlock}}"/>
                                    <DataGridTextColumn Header="Remarks" Binding="{Binding Remarks}" Width="*" 
                                                        HeaderStyle="{StaticResource {x:Type DataGridColumnHeader}}" 
                                                        ElementStyle="{StaticResource {x:Type TextBlock}}"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </ScrollViewer>
                    </StackPanel>
                </Border>

                <!-- Performance Statistics -->
                <Border Grid.Column="1" Background="White" CornerRadius="8" BorderBrush="#EEE" BorderThickness="1" Padding="20" Margin="5">
                    <StackPanel>
                        <TextBlock Text="Performance Statistics" FontWeight="Bold" FontSize="16" Margin="0,0,0,15"/>
                        
                        <!-- High Performers -->
                        <StackPanel Margin="0,10">
                            <DockPanel>
                                <TextBlock Text="High Performers (4.0+)" FontWeight="SemiBold"/>
                                <TextBlock Text="{Binding HighPerformers}" Foreground="#10B981" DockPanel.Dock="Right" FontWeight="Bold"/>
                            </DockPanel>
                            <ProgressBar Value="{Binding HighPerformers}" Maximum="{Binding TotalEvaluations}" Height="8" Margin="0,5,0,2"/>
                        </StackPanel>

                        <!-- Average Performers -->
                        <StackPanel Margin="0,10">
                            <DockPanel>
                                <TextBlock Text="Average Performers (2.5-3.9)" FontWeight="SemiBold"/>
                                <TextBlock Text="{Binding AveragePerformers}" Foreground="#F59E0B" DockPanel.Dock="Right" FontWeight="Bold"/>
                            </DockPanel>
                            <ProgressBar Value="{Binding AveragePerformers}" Maximum="{Binding TotalEvaluations}" Height="8" Margin="0,5,0,2"/>
                        </StackPanel>

                        <!-- Low Performers -->
                        <StackPanel Margin="0,10">
                            <DockPanel>
                                <TextBlock Text="Low Performers (&lt;2.5)" FontWeight="SemiBold"/>
                                <TextBlock Text="{Binding LowPerformers}" Foreground="#EF4444" DockPanel.Dock="Right" FontWeight="Bold"/>
                            </DockPanel>
                            <ProgressBar Value="{Binding LowPerformers}" Maximum="{Binding TotalEvaluations}" Height="8" Margin="0,5,0,2"/>
                        </StackPanel>

                        <!-- Summary -->
                        <Border Background="#F8FAFC" CornerRadius="6" Padding="15" Margin="0,20,0,0">
                            <StackPanel>
                                <TextBlock Text="Summary" FontWeight="Bold" FontSize="14" Margin="0,0,0,10"/>
                                <TextBlock Text="{Binding TotalEvaluations, StringFormat=Total Evaluations: {0}}" FontSize="12" Margin="0,2"/>
                                <TextBlock Text="{Binding AverageScore, StringFormat=Average Score: {0:F2}}" FontSize="12" Margin="0,2"/>
                                <TextBlock Text="{Binding SalesAchievementRate, StringFormat=Sales Achievement: {0:F1}%}" FontSize="12" Margin="0,2"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>
    </ScrollViewer>
</UserControl>

